define(["dojo/Deferred","dojo/request/registry","dojo/request/xhr","dojo/_base/array"],function(n,t,i,r){"use strict";var u={xdr:function(t,i){var f=new n,u=new XDomainRequest,e;if(u){i.preventCache&&(e="request.preventCache="+Math.random().toString().replace("0.",""),e=t.indexOf("?")===-1?"?"+e:"&"+e,t=t+e);try{u.open(i.method||"GET",t),u.onload=function(){var t,n,r;i.handleAs.toLowerCase()==="text"?f.resolve(u.responseText):i.handleAs.toLowerCase()==="json"?(u.responseText&&u.responseText!==""&&(t=JSON.parse(u.responseText)),f.resolve(t)):i.handleAs.toLowerCase()==="xml"?(window.DOMParser?(r=new window.DOMParser,n=r.parseFromString(u.responseText,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(u.responseText)),f.resolve(n)):f.resolve(u.responseText)},u.onerror=function(n){f.reject(new Error(n))},u.ontimeout=function(n){f.reject(new Error(n))},u.onprogress=function(){},r.forEach(i.query,function(n){t+=t.indexOf("?")!==-1?"&":"?",t+=n+"="+i.query[n]}),i.preventCache&&(t+=t.indexOf("?")!==-1?"&":"?",t+="_cb="+(new Date).getTime()),u.timeout=5e4,u.send()}catch(o){window.alert(o)}return f}return f.reject(new Error("XDomainRequest not supported.")),f},corsProvider:function(n,t){return window.XDomainRequest?u.xdr(n,t):i(n,t)},corsRegester:function(n){return t.register(n,u.corsProvider)}};return u.corsRegester})