define(["dojo/dom-style","dijit/registry","dojo/parser","dojo/dom","dojo/dom-construct","dojo/request/xhr","dojo/query","dojo/_base/array","dojo/promise/all","dojo/dom-class","dojo/_base/connect","dojo/_base/window","dojo/_base/lang","dojox/mobile"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){"use strict";var v=a.getObject("dojox.mobile",!0);return v.tabletSize=820,v.detectScreenSize=function(n){var u=v.getScreenSize(),i=u.w,r,t;i>=v.tabletSize&&(n||!this._sz||this._sz<v.tabletSize)?(r="phone",t="tablet"):i<v.tabletSize&&(n||!this._sz||this._sz>=v.tabletSize)&&(r="tablet",t="phone"),t&&(h.replace(l.doc.documentElement,"dj_"+t,"dj_"+r),c.publish("/dojox/mobile/screenSize/"+t,[u])),this._sz=i},v.detectScreenSize(),window.app={showDebug:!1,tabletSize:v.tabletSize,phoneSize:480,initilize:function(){String.prototype.getBytes=function(){for(var t=[],n=0;n<this.length;n+=1)t.push(this.charCodeAt(n));return t},String.prototype.extractNumber=function(){return parseFloat(this.match(/[\d\.]+/))},String.prototype.capitalizeWords=function(){for(var i=this.split(" "),n=0;n<i.length;n=n+1){var r=i[n],u=r.substr(0,1),f=r.substr(1,r.length-1),t=u.toUpperCase()+f.toLowerCase();t==="Kg"?t="kg":t==="Mmhg"&&(t="mmHg"),i[n]=t}return i.join(" ")},window.onresize=window.app.display.resize,window.onbeforeunload=window.app.checkBeforeUnload,e(".ShowOnConnect").forEach(function(t){n.set(t,"display","none")}),e(".ShowOnDisconnect").forEach(function(t){n.set(t,"display","")}),window.app.showDebug!==!0&&(n.set(r.byId("listItemDataLogHeading"),"display","none"),n.set(r.byId("listItemDataLogMenu"),"display","none"))},loadForms:function(){var n=window.app.loadView("ExistingUser","viewExistingUser"),t=window.app.loadView("AnonymousUser","viewAnonymousUser"),i=window.app.loadView("Logout","viewLogout"),u=window.app.loadView("ResetPassword","viewResetPassword"),f=window.app.loadView("WeeklyFoodSummaries","viewWeeklyFoodSummaries"),e=window.app.loadView("WeeklyMeasurementSummaries","viewWeeklyMeasurementSummaries"),o=window.app.loadView("DailyFoodEntries","viewDailyFoodEntries"),h=window.app.loadView("DailyMeasurementEntries","viewDailyMeasurementEntries"),c=window.app.loadView("NewFoodEntryOptions","viewNewFoodEntryOptions"),l=window.app.loadView("NewMeasurementEntryOptions","viewNewMeasurementEntryOptions"),a=window.app.loadView("NewFoodEntrySource","viewNewFoodEntrySource"),v=window.app.loadView("SearchFood","viewSearchFood"),y=window.app.loadView("NewFoodEntryAmount","viewNewFoodEntryAmount"),p=window.app.loadView("FoodDetails","viewFoodDetails"),w=window.app.loadView("FoodEntryHistory","viewFoodEntryHistory"),b=window.app.loadView("NewMeasurementEntryOptions","viewNewMeasurementEntryOptions"),k=window.app.loadView("NewMeasurementEntryAmount","viewNewMeasurementEntryAmount"),d=window.app.loadView("UpdateFoodEntry","viewUpdateFoodEntry"),g=window.app.loadView("UpdateMeasurementEntry","viewUpdateMeasurementEntry"),nt=window.app.loadView("ChangeEMail","viewChangeEMail"),tt=window.app.loadView("ChangePassword","viewChangePassword");s([n,t,i,u,f,e,o,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt]).then(window.app.prepairUI),window.app.data.retreveVersion().then(function(){var n=r.byId("divServerInfo");n&&(n.innerHTML="Version "+window.app.data.server.versionInformation+" "+window.app.data.server.serverName)})},storeLocaly:function(n,t){if(window.localStorage!==null)return window.localStorage.setItem(n,t)},retreveLocaly:function(n){if(window.localStorage!==null)return window.localStorage.getItem(n)},prepairUI:function(){var e=window.app,o=window.app.data,i,f,u,s,h,c,l="";f=e.retreveLocaly("userName"),u=e.retreveLocaly("sessionGuid"),s=e.retreveLocaly("authorizationExpires"),u&&(h=new Date,c=new Date(s),h>c&&(u=undefined,s=undefined)),(f===null||f===undefined)&&(f=""),(u===null||u==="")&&(u=undefined),window.app.showDebug&&(f="test.user.1@keldan.co.uk",l="aaa",u=undefined),o.currentUser.userEmail=f,o.currentUser.sessionGuid=u,o.currentUser.authorization=u,r.byId("inputUserEmail").value=f,r.byId("inputPassword").value=l,i=t.byId("valuePickerNewFoodUnit"),i&&i.watch("value",window.app.display.adjustValuePicker),i=t.byId("valuePickerUpdateFoodUnit"),i&&i.watch("value",window.app.display.adjustValuePicker),i=t.byId("valuePickerNewMeasurementUnit"),i&&i.watch("value",window.app.display.adjustValuePicker),i=t.byId("valuePickerUpdateMeasurementUnit"),i&&i.watch("value",window.app.display.adjustValuePicker),window.app.display.resize(),n.set("divSplashScreen","display","none"),u!==undefined&&(e.actions.reConnect(),e.displayView("viewWeeklyFoodSummaries"))},checkBeforeUnload:function(n){var t=window.app.data,i;if(t&&t.currentUser&&t.currentUser.sessionGuid)return i="The back button moves to the previous webpage",n||(n=window.event),n.returnValue=i,n.cancelBubble=!0,n.stopPropagation&&(n.stopPropagation(),n.preventDefault()),i},displayView:function(n,i){var r=t.byId(n),u=r.getShowingView();i===undefined&&(i="slide"),u!==r&&u.performTransition("#"+n,1,i)},loadView:function(n,r){var u="./views/"+n+".htm";return f(u,{method:"GET",handleAs:"text",preventCache:!1}).then(function(n){var u=t.byId(r).containerNode,f;u===undefined&&window.alert(r+" missing"),u.innerHTML=n,i.parse(u),window.app.showDebug&&(f=t.byId(r),f&&o.forEach(f.getChildren(),function(n){n.baseClass==="mblHeading"&&n.set("label",n.get("label")+" ["+r+"]")}))},function(n,t){window.alert(n+":"+t)})},showDialog:function(n,i){var r=t.byId(n);r.goToView=i,r.show()},hideDialog:function(n){var i=t.byId(n);i.hide(),i.goToView!==undefined&&window.app.displayView(i.goToView,"fade")},trace:function(n){this.showDebug&&r.byId("divTrace")&&u.place("<div>"+n+"<\/div>","divTrace","last")},actionOnEnterKey:function(n,t,i,r){var u=t.keyIdentifier;u||(u=t.key),n&&t&&i&&u==="Enter"&&(n.blur(),i(),r&&window.app.displayView(r))},focusOnEnterKey:function(n,t,i){var u=t.keyIdentifier,f=r.byId(i);u||(u=t.key),n&&t&&i&&f&&u==="Enter"&&(n.blur(),f.focus())}},window.app})